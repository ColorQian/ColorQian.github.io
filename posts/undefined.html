<figure class="highlight jsp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">"text/html;charset=UTF-8"</span> language=<span class="string">"java"</span> %&gt;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">"utf-8"</span>&gt;</span><br><span class="line">    &lt;script src="${pageContext.request.contextPath}/js/jquery.min.js"&gt;&lt;/script&gt;</span><br><span class="line">    &lt;title&gt;SpringBoot+WebSocket+JSP&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body style=<span class="string">"margin: 45px;"</span>&gt;</span><br><span class="line">    &lt;h4&gt;在线聊天室&lt;/h4&gt;</span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"form-group"</span>&gt;</span><br><span class="line">        &lt;label for="content"&gt;&lt;/label&gt;</span><br><span class="line">        &lt;textarea id="content" readonly="readonly" cols="80" rows="15"&gt;&lt;/textarea&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;div <span class="class"><span class="keyword">class</span></span>=<span class="string">"form-group"</span> style=<span class="string">"margin-top: 8px"</span>&gt;</span><br><span class="line">        &lt;textarea id="message" cols="80" rows="5" placeholder="请输入消息"&gt;&lt;/textarea&gt;</span><br><span class="line">        &lt;div style=<span class="string">"margin-top: 10px"</span>&gt;</span><br><span class="line">            &lt;button id="toSend" class="btn btn-info"&gt;发送&lt;/button&gt;</span><br><span class="line">            &lt;button id="user_exit" class="btn btn-danger"&gt;离开&lt;/button&gt;</span><br><span class="line">            &lt;input id=<span class="string">"username"</span> value=<span class="string">"${username}"</span> style=<span class="string">"display: none"</span>&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &lt;script type=<span class="string">"text/javascript"</span>&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        $(function () {</span><br><span class="line">            <span class="keyword">var</span> ws;</span><br><span class="line">            <span class="keyword">if</span> (<span class="string">"WebSocket"</span> in window) {</span><br><span class="line">                <span class="keyword">var</span> baseUrl = <span class="string">'ws://localhost:8080/websocket/'</span>;</span><br><span class="line">                <span class="keyword">var</span> userName = $(<span class="string">'#username'</span>).val();</span><br><span class="line">                ws = <span class="keyword">new</span> WebSocket(baseUrl + userName);</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 连通之后的回调事件，建立连接</span></span><br><span class="line">                ws.onopen = function () {</span><br><span class="line">                    console.log(<span class="string">"建立 websocket 连接..."</span>);</span><br><span class="line">                };</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 接收后台服务端的消息</span></span><br><span class="line">                ws.onmessage = function (event) {</span><br><span class="line">                    $(<span class="string">'#content'</span>).append(event.data + <span class="string">'\n\n'</span>);</span><br><span class="line">                    console.log(<span class="string">"接收到服务端发送的消息..."</span> + event.data + <span class="string">'\n'</span>);</span><br><span class="line">                };</span><br><span class="line"></span><br><span class="line">                ws.onerror = function (event) {</span><br><span class="line">                    console.log(<span class="string">"websocket发生错误..."</span> + event + <span class="string">'\n'</span>);</span><br><span class="line">                }</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 连接关闭的回调事件</span></span><br><span class="line">                ws.onclose = function () {</span><br><span class="line">                    $(<span class="string">'#content'</span>).append(<span class="string">'['</span> + userName + <span class="string">'] 已离开!'</span>);</span><br><span class="line">                    console.log(<span class="string">"关闭 websocket 连接..."</span>);</span><br><span class="line">                };</span><br><span class="line">            } <span class="keyword">else</span> {</span><br><span class="line">                <span class="comment">// 浏览器不支持 WebSocket</span></span><br><span class="line">                alert(<span class="string">"您的浏览器不支持WebSocket!"</span>);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 客户端发送消息到服务器</span></span><br><span class="line">            $(<span class="string">'#toSend'</span>).click(function () {</span><br><span class="line">                sendMsg();</span><br><span class="line">            });</span><br><span class="line"></span><br><span class="line">            $(document).keyup(function (event) {</span><br><span class="line">                <span class="comment">// 回车键事件</span></span><br><span class="line">                <span class="keyword">if</span> (event.keyCode == <span class="number">13</span>) {</span><br><span class="line">                    sendMsg();</span><br><span class="line">                }</span><br><span class="line">            });</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 发送消息</span></span><br><span class="line">            <span class="function">function <span class="title">sendMsg</span><span class="params">()</span> </span>{</span><br><span class="line">                <span class="comment">//websocket发送消息</span></span><br><span class="line">                ws.send($(<span class="string">'#message'</span>).val());</span><br><span class="line">                $(<span class="string">'#message'</span>).val(<span class="string">""</span>);</span><br><span class="line">            }</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 退出</span></span><br><span class="line">            $(<span class="string">'#user_exit'</span>).click(function () {</span><br><span class="line">                <span class="keyword">if</span> (ws) {</span><br><span class="line">                    ws.close();</span><br><span class="line">                }</span><br><span class="line">            });</span><br><span class="line">        });</span><br><span class="line"></span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;%--此页面的源代码即为index.jsp的代码--%&gt;</span><br><span class="line">&lt;%--点击右键即可查看网页源代码--%&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></tbody></table></figure>

